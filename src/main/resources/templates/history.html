<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
	<meta charset="UTF-8">
	<title>為替変換履歴</title>
	<style>
		body {
			font-family: Arial, sans-serif;
			background: #f5f5f5;
			padding: 20px;
		}

		table {
			border-collapse: collapse;
			width: 100%;
			background: #fff;
			box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
		}

		th,
		td {
			padding: 10px 15px;
			text-align: center;
			border-bottom: 1px solid #ddd;
		}

		th {
			background: #4CAF50;
			color: #fff;
		}

		tr:hover {
			background: #f1f1f1;
		}

		tbody tr:nth-child(even) {
			background: #f9f9f9;
		}

		caption {
			caption-side: top;
			text-align: left;
			font-size: 1.5em;
			margin-bottom: 10px;
			font-weight: bold;
		}
		
	</style>
</head>

<body>
	<!-- ナビゲーション -->
	<nav sec:authorize="isAuthenticated()" style="margin-bottom: 20px;">
		<a href="/exchange">通貨変換</a>
		<a href="/exchange/history">変換履歴</a>

		<!-- ログイン中のユーザ名 -->
		<span sec:authentication="name"></span>さん

		<!-- ログアウトボタン（CSRF 対応） -->
		<form method="post" action="/logout" style="display: inline;">
			<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
			<button type="submit">ログアウト</button>
		</form>
	</nav>
	<table>
		<caption>為替変換履歴</caption>
		<thead>
			<tr>
				<th>No.</th>
				<th>基準通貨</th>
				<th>対象通貨</th>
				<th>レート</th>
				<th>変換前の金額</th>
				<th>変換後の金額</th>
				<th>取得日時</th>
				<th>操作</th>
			</tr>
		</thead>
		<tbody>
			<tr th:each="rate, stat : ${rates}">
				<td th:text="${rates.number * rates.size + stat.index + 1}"></td>
				<td th:text="${rate.baseCurrency}"></td>
				<td th:text="${rate.targetCurrency}"></td>
				<td th:text="${#numbers.formatDecimal(rate.rate, 1, 'COMMA', 4, 'POINT')}"></td>
				<td th:text="${#numbers.formatDecimal(rate.amount, 1, 'COMMA', 2, 'POINT')}"></td>
				<td th:text="${#numbers.formatDecimal(rate.convertedAmount, 1, 'COMMA', 2, 'POINT')}"></td>
				<td th:text="${rate.fetchedAtText}"></td>
				<td>
					<form th:action="@{/exchange/history/delete}" method="post">
						<input type="hidden" name="id" th:value="${rate.id}">
						<button type="submit" onclick="return confirm('本当に削除しますか？');">削除</button>
					</form>
				</td>
			</tr>
		</tbody>
	</table>
	<div>
		<span th:if="${rates.hasPrevious()}">
			<a th:href="@{/exchange/history(page=${rates.number - 1})}">前へ</a>
		</span>
		<span>ページ[[${rates.number + 1}]] / [[${rates.totalPages}]]</span>
		<span th:if="${rates.hasNext()}">
			<a th:href="@{/exchange/history(page=${rates.number + 1})}">次へ</a>
		</span>
	</div>
</body>

</html>